{% extends 'layout.html' %}

{% block title %}Dashboard - MediGuard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
    <!-- Welcome Card -->
    <div class="col-span-1 md:col-span-2 lg:col-span-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg shadow-lg p-4 md:p-6">
        <h1 class="text-xl md:text-3xl font-bold mb-2">Welcome back, {{ user.username }}! ðŸ‘‹</h1>
        <p class="text-sm md:text-base text-blue-100">Stay on top of your health with MediGuard</p>
    </div>
    
    <!-- Medicine Stats -->
    <div class="bg-white rounded-lg shadow p-4 md:p-6 border-l-4 border-green-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-xs md:text-sm">Total Medicines</p>
                <p class="text-2xl md:text-3xl font-bold text-gray-800">{{ total_medicines }}</p>
            </div>
            <i class="fas fa-pills text-3xl md:text-4xl text-green-500 opacity-20"></i>
        </div>
    </div>
    
    <!-- Verified Stats -->
    <div class="bg-white rounded-lg shadow p-4 md:p-6 border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-xs md:text-sm">Verified</p>
                <p class="text-2xl md:text-3xl font-bold text-gray-800">{{ verified_count }}</p>
            </div>
            <i class="fas fa-check-circle text-3xl md:text-4xl text-blue-500 opacity-20"></i>
        </div>
    </div>
    
    <!-- Verification Rate -->
    <div class="bg-white rounded-lg shadow p-4 md:p-6 border-l-4 border-purple-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-500 text-xs md:text-sm">Verification Rate</p>
                <p class="text-2xl md:text-3xl font-bold text-gray-800">{{ verified_percentage }}%</p>
            </div>
            <i class="fas fa-shield-alt text-3xl md:text-4xl text-purple-500 opacity-20"></i>
        </div>
    </div>
</div>

<!-- Upcoming Reminders -->
<div class="bg-white rounded-lg shadow p-4 md:p-6 mb-6 md:mb-8">
    <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-3 md:mb-4">
        <i class="fas fa-bell text-yellow-500 mr-2"></i> Upcoming Reminders
    </h2>
    {% if upcoming_reminders %}
    <div class="space-y-2 md:space-y-3 overflow-x-auto">
        {% for reminder in upcoming_reminders %}
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between bg-yellow-50 border border-yellow-200 rounded-lg p-3 md:p-4 gap-3">
            <div class="flex-1 min-w-0">
                <p class="font-semibold text-gray-800 truncate">{{ reminder.medicine.name }}</p>
                <p class="text-xs md:text-sm text-gray-600">
                    <i class="far fa-clock mr-1"></i> {{ reminder.reminder_time.strftime('%Y-%m-%d %H:%M') }}
                </p>
                <p class="text-xs text-gray-500">{{ reminder.medicine.dosage }}</p>
            </div>
            <button onclick="markReminderTaken('{{ reminder.id }}')" class="btn-primary w-full md:w-auto whitespace-nowrap text-sm">
                Mark Taken
            </button>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500 text-center py-4 text-sm">No reminders for the next 24 hours</p>
    {% endif %}
</div>

<!-- Recent Prescriptions -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
    <div class="bg-white rounded-lg shadow p-4 md:p-6">
        <h2 class="text-lg md:text-2xl font-bold text-gray-800 mb-3 md:mb-4">
            <i class="fas fa-file-medical text-red-500 mr-2"></i> Recent Prescriptions
        </h2>
        {% if recent_prescriptions %}
        <div class="space-y-3">
            {% for prescription in recent_prescriptions %}
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 hover:bg-gray-100 transition">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="font-semibold text-gray-800">{{ prescription.filename }}</p>
                        <p class="text-xs text-gray-500">{{ prescription.uploaded_on.strftime('%Y-%m-%d %H:%M') }}</p>
                        <p class="text-sm text-gray-600 mt-1">{{ prescription.medicines|length }} medicine(s)</p>
                    </div>
                    <a href="{{ url_for('view_prescription', id=prescription.id) }}" class="text-blue-600 hover:text-blue-800">
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        <a href="{{ url_for('prescriptions') }}" class="mt-4 inline-block btn-secondary">View All</a>
        {% else %}
        <p class="text-gray-500 text-center py-8">No prescriptions yet. <a href="{{ url_for('upload_prescription') }}" class="text-blue-600 hover:underline">Upload one now!</a></p>
        {% endif %}
    </div>
    
    <!-- Quick Actions -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">
            <i class="fas fa-lightning-bolt text-orange-500 mr-2"></i> Quick Actions
        </h2>
        <div class="space-y-3">
            <a href="{{ url_for('upload_prescription') }}" class="block btn-primary w-full text-center">
                <i class="fas fa-upload mr-2"></i> Upload Prescription
            </a>
            <a href="{{ url_for('verify_medicine') }}" class="block btn-secondary w-full text-center">
                <i class="fas fa-camera mr-2"></i> Verify Medicine
            </a>
            <a href="{{ url_for('prescriptions') }}" class="block btn-secondary w-full text-center">
                <i class="fas fa-list mr-2"></i> View All Prescriptions
            </a>
        </div>
    </div>
</div>

<script>
function markReminderTaken(reminderId) {
    fetch(`/reminder/${reminderId}/mark-taken`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(e => alert('Error: ' + e));
}
</script>

{% endblock %}
